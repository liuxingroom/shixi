<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xing.wlxt.export.dao.ExportMapper">
   <resultMap type="com.xing.wlxt.export.entity.Export" id="exportRM">
		<id property="id" column="EXPORT_ID"/>
		
		<!-- 虚拟字段 -->
		<result property="epnum" column="EPNUM"/>
		<result property="extnum" column="EXTNUM"/>
		
		<result property="inputDate" column="INPUT_DATE"/>
		<result property="contractIds" column="CONTRACT_IDS"/>
		<result property="customerContract" column="CUSTOMER_CONTRACT"/>
		<result property="LCNO" column="LCNO"/>
		<result property="consignee" column="CONSIGNEE"/>
		<result property="marks" column="MARKS"/>
		<result property="remark" column="REMARK"/>
		<result property="shipmentPort" column="SHIPMENT_PORT"/>
		<result property="destinationPort" column="DESTINATION_PORT"/>
		<result property="transportMode" column="TRANSPORT_MODE"/>
		<result property="priceCondition" column="PRICE_CONDITION"/>
		<result property="grossWeight" column="GROSS_WEIGHT"/>
		<result property="netWeight" column="NET_WEIGHT"/>
		<result property="measurement" column="MEASUREMENT"/>
		<result property="state" column="STATE"/>
		
		<result property="createBy" column="CREATE_BY"/>
		<result property="createDept" column="CREATE_DEPT"/>
		<result property="createTime" column="CREATE_TIME"/>
	</resultMap>
	
	<select id="find" parameterType="com.xing.wlxt.export.search.ExportSearch" resultMap="exportRM">
		select (select count(*)
          from export_product_c ecp
         where ecp.export_id = e.export_id) EPNUM,
       (select count(*)
          from ext_eproduct_c eep
         where eep.export_product_id in
               (select ecp.export_product_id
                  from export_product_c ecp
                 where ecp.export_id = e.export_id)) EXTNUM,
       e.export_id,
       e.input_date,
       e.contract_ids,
       e.customer_contract,
       e.lcno,
       e.consignee,
       e.marks,
       e.remark,
       e.shipment_port,
       e.destination_port,
       e.transport_mode,
       e.price_condition,
       e.gross_weight,
       e.net_weight,
       e.measurement,
       e.state
  from export_c e	
	</select>
	
	<!-- 通过报运单id来获取报运信息 -->
	<select id="get" resultMap="exportRM">
		select * from export_c where  EXPORT_ID=#{id}
	</select>
	
	<!-- 修改报运单信息 -->
	<update id="update" parameterType="com.xing.wlxt.export.entity.Export">
		update 	export_c 
		<trim suffixOverrides=",">
			<set>
				<if test="inputDate !=null">INPUT_DATE=#{inputDate},</if>
				<if test="contractIds !=null">CONTRACT_IDS=#{contractIds},</if>
				<if test="customerContract !=null">CUSTOMER_CONTRACT=#{customerContract},</if>
				<if test="LCNO !=null">LCNO=#{LCNO},</if>
				<if test="consignee !=null">CONSIGNEE=#{consignee},</if>
				<if test="marks !=null">MARKS=#{marks},</if>
				<if test="remark !=null">REMARK=#{remark},</if>
				<if test="shipmentPort !=null">SHIPMENT_PORT=#{shipmentPort},</if>
				<if test="destinationPort !=null">DESTINATION_PORT=#{destinationPort},</if>
				<if test="transportMode !=null">TRANSPORT_MODE=#{transportMode},</if>
				<if test="priceCondition !=null">PRICE_CONDITION=#{priceCondition},</if>
				<if test="grossWeight !=null">GROSS_WEIGHT=#{grossWeight},</if>
				<if test="netWeight !=null">NET_WEIGHT=#{netWeight},</if>
				<if test="measurement !=null">MEASUREMENT=#{measurement},</if>
				<if test="state !=null">STATE=#{state},</if>
			</set>
		</trim>
		where export_id=#{id}
	</update>
	
	<!-- 根据报运单id来删除报运信息 -->
	<delete id="delete">
		delete from export_c where export_id 
		<foreach collection="ids" open="in(" close=")" separator="," item="id">
			#{id}
		</foreach>
	</delete>
</mapper>